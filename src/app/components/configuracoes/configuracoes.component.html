<div class="config">
  <div class="card-title">
    <i
      (click)="verificarAlteracao() ? confirmar() : voltar()"
      class="fa-solid fa-arrow-left"
    ></i>
    <div>
      <h2>Configurações</h2>
      <span>Gerencie suas Informações</span>
    </div>
  </div>

  <!-- Abas -->
  <div class="card card-header">
    <div
      class="card-header-item"
      [class.active]="abaAtiva === 'pessoal'"
      (click)="selecionarAba('pessoal')"
    >
      <i class="fa fa-user"></i><span>Pessoal</span>
    </div>
    <div
      class="card-header-item"
      [class.active]="abaAtiva === 'seguranca'"
      (click)="selecionarAba('seguranca')"
    >
      <i class="fa-solid fa-lock"></i><span>Segurança</span>
    </div>
  </div>

  <!-- Conteúdo -->
  <div class="conteudo">
    <!-- Aba Pessoal -->
    <ng-container *ngIf="abaAtiva === 'pessoal'">
      <form [formGroup]="formPessoal" (ngSubmit)="onSubmitPessoal()">
        <!-- FOTO DO PERFIL -->
        <div class="card card-foto-perfil">
          <h2>Foto do Perfil</h2>
          <div class="foto-perfil">
            <img
              [src]="mockUserFoto || 'assets/User.svg'"
              alt="Foto do usuário"
              class="user-photo"
            />

            <div>
              <label class="btn-upload">
                <i class="fa-solid fa-camera"></i> Alterar foto
                <input
                  type="file"
                  (change)="onFotoSelecionada($event)"
                  hidden
                />
              </label>
              <span>JPG ou PNG. Máximo 2MB.</span>
            </div>
          </div>
        </div>

        <!-- INFORMAÇÕES PESSOAIS -->
        <div class="card card-info-pessoal">
          <h2>Informações Pessoais</h2>
          <div class="info-pessoal">
            <div class="form-group">
              <label>Nome completo</label>
              <input
                type="text"
                formControlName="nome"
                [class.invalid]="
                  formPessoal.get('nome')?.touched &&
                  formPessoal.get('nome')?.invalid
                "
              />
              <small
                *ngIf="
                  formPessoal.get('nome')?.touched &&
                  formPessoal.get('nome')?.invalid
                "
              >
                Nome é obrigatório e deve ter pelo menos 3 caracteres.
              </small>
            </div>

            <div class="form-group">
              <label>Email</label>
              <input
                type="email"
                formControlName="email"
                [class.invalid]="
                  formPessoal.get('email')?.touched &&
                  formPessoal.get('email')?.invalid
                "
              />
              <small
                *ngIf="
                  formPessoal.get('email')?.touched &&
                  formPessoal.get('email')?.invalid
                "
              >
                Informe um e-mail válido.
              </small>
            </div>

            <div class="form-group">
              <label>Telefone</label>
              <input
                type="text"
                formControlName="telefone"
                placeholder="(99) 99999-9999"
                [class.invalid]="
                  formPessoal.get('telefone')?.touched &&
                  formPessoal.get('telefone')?.invalid
                "
              />
              <small
                *ngIf="
                  formPessoal.get('telefone')?.touched &&
                  formPessoal.get('telefone')?.invalid
                "
              >
                Informe um telefone válido no formato (99) 99999-9999.
              </small>
            </div>
          </div>
        </div>

        <!-- ENDEREÇO -->
        <div class="card card-info-pessoal">
          <h2>Endereço</h2>
          <div class="info-pessoal">
            <div class="form-group">
              <label>Rua / Número</label>
              <input
                type="text"
                formControlName="rua"
                [class.invalid]="
                  formPessoal.get('rua')?.touched &&
                  formPessoal.get('rua')?.invalid
                "
              />
              <small
                *ngIf="
                  formPessoal.get('rua')?.touched &&
                  formPessoal.get('rua')?.invalid
                "
              >
                A rua e o número são obrigatórios.
              </small>
            </div>

            <div class="form-group">
              <label>Cidade</label>
              <input
                type="text"
                formControlName="cidade"
                [class.invalid]="
                  formPessoal.get('cidade')?.touched &&
                  formPessoal.get('cidade')?.invalid
                "
              />
              <small
                *ngIf="
                  formPessoal.get('cidade')?.touched &&
                  formPessoal.get('cidade')?.invalid
                "
              >
                A cidade é obrigatória.
              </small>
            </div>

            <div class="form-group">
              <label>Estado</label>
              <select
                formControlName="estado"
                [class.invalid]="
                  formPessoal.get('estado')?.touched &&
                  formPessoal.get('estado')?.invalid
                "
              >
                <option value="">Selecione</option>
                <option *ngFor="let uf of estados" [value]="uf">
                  {{ uf }}
                </option>
              </select>
              <small
                *ngIf="
                  formPessoal.get('estado')?.touched &&
                  formPessoal.get('estado')?.invalid
                "
              >
                Selecione um estado.
              </small>
            </div>
          </div>
        </div>

        <button type="submit" class="btn-salvar" [disabled]="!formPessoal.dirty">Salvar Alterações</button>
      </form>
    </ng-container>

    <!-- Aba Segurança -->
    <ng-container *ngIf="abaAtiva === 'seguranca'">
      <form [formGroup]="formSeguranca" (ngSubmit)="onSubmitSeguranca()">
        <div class="card card-seguranca">
          <h2>Alterar Senha</h2>
          <span style="font-size: 0.75rem; color: gray"
            >Mantenha sua conta segura com uma senha forte</span
          >
          <div class="seguranca">
            <div class="form-group">
              <label>Senha atual</label>
              <input
                type="password"
                formControlName="senhaAtual"
                [class.invalid]="
                  formSeguranca.get('senhaAtual')?.touched &&
                  formSeguranca.get('senhaAtual')?.invalid
                "
              />
              <small
                *ngIf="
                  formSeguranca.get('senhaAtual')?.touched &&
                  formSeguranca.get('senhaAtual')?.invalid
                "
              >
                A senha atual é obrigatória e deve ter pelo menos 6 caracteres.
              </small>
            </div>

            <div class="form-group">
              <label>Nova senha</label>
              <input
                type="password"
                formControlName="novaSenha"
                [class.invalid]="
                  formSeguranca.get('novaSenha')?.touched &&
                  formSeguranca.get('novaSenha')?.invalid
                "
              />
              <small
                *ngIf="
                  formSeguranca.get('novaSenha')?.touched &&
                  formSeguranca.get('novaSenha')?.invalid
                "
              >
                A nova senha deve ter pelo menos 6 caracteres.
              </small>
            </div>

            <div class="form-group">
              <label>Confirmar nova senha</label>
              <input
                type="password"
                formControlName="confirmarSenha"
                [class.invalid]="formSeguranca.errors?.['senhasDiferentes'] && formSeguranca.get('confirmarSenha')?.touched"
              />
              <small
                *ngIf="formSeguranca.errors?.['senhasDiferentes'] && formSeguranca.get('confirmarSenha')?.touched"
              >
                As senhas não coincidem.
              </small>
            </div>
          </div>
        </div>
        <div class="card card-seg-conta">
          <h2>Segurança da Conta</h2>
          <div class="seguranca-conta">
            <i class="fa-solid fa-circle-check" style="color: #63e6be"></i>
            <div>
              <span>Último acesso:</span>
              <span>Hoje às 09:15</span>
            </div>
          </div>
          <div class="seguranca-conta">
            <i class="fa-solid fa-xmark" style="color: #cb2a2a"></i>
            <div>
              <span>Autenticação de dois fatores:</span>
              <span>Não configurado</span>
            </div>
          </div>
        </div>
        <button type="submit" class="btn-salvar" [disabled]="!formSeguranca.dirty">Salvar Alterações</button>
      </form>
    </ng-container>
  </div>
</div>
